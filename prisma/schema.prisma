// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

generator erd {
  provider = "prisma-erd-generator"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Session {
  id           String   @id @default(cuid())
  userId       Int
  expires      DateTime
  sessionToken String   @unique
  accessToken  String   @unique
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id])
}

model Status {
  id   Int    @id @default(autoincrement())
  name String @unique
  User User[]
}

model Role {
  id   Int    @id @default(autoincrement())
  name String @unique
  User User[]
}

model User {
  id               Int                @id @default(autoincrement())
  username         String?            @unique
  email            String?            @unique
  password         String?
  firstname        String?
  lastname         String?
  tel              String
  image            String
  license          String
  roleId           Int
  role             Role?              @relation(fields: [roleId], references: [id])
  empId            Int?
  companyId        Int
  company          Company?           @relation(fields: [companyId], references: [id])
  departmentId     Int
  department       Department?        @relation(fields: [departmentId], references: [id])
  positionId       Int
  position         Position?          @relation(fields: [positionId], references: [id])
  statusId         Int
  status           Status?            @relation(fields: [statusId], references: [id])
  step             Int                @default(0)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  RequestEquipment RequestEquipment[]
  ApproveEquipment ApproveEquipment[]
  Session          Session[]
}

model Company {
  id   Int     @id @default(autoincrement())
  name String? @unique
  User User[]
}

model Department {
  id   Int     @id @default(autoincrement())
  name String? @unique
  User User[]
}

model Position {
  id   Int     @id @default(autoincrement())
  name String? @unique
  User User[]
}

model TableProcess {
  id    Int    @id @default(autoincrement())
  docNo String
  name  String
  step  Int
  Step  Step[]
}

model Step {
  id        Int               @id @default(autoincrement())
  processId Int
  process   TableProcess?     @relation(fields: [processId], references: [id])
  requestId String
  request   RequestEquipment? @relation(fields: [requestId], references: [id])
  status    Int               @default(0)
}

model RequestEquipment {
  id               String             @id
  purpose          String
  requestDate      DateTime           @default(now())
  requestById      Int
  requestBy        User?              @relation(fields: [requestById], references: [id])
  completeDate     DateTime           @default(now())
  document         String             @default("")
  remark           String             @default("")
  price            Float              @default(0)
  step             Int                @default(1)
  ApproveEquipment ApproveEquipment[]
  Equipment        Equipment[]
  Step             Step[]
}

model ApproveEquipment {
  id          Int               @id @default(autoincrement())
  requestId   String
  request     RequestEquipment? @relation(fields: [requestId], references: [id])
  approveById Int
  approveBy   User?             @relation(fields: [approveById], references: [id])
  step        Int
  status      Int
}

model Equipment {
  id        Int               @id @default(autoincrement())
  assetId   Int
  asset     Asset?            @relation(fields: [assetId], references: [id])
  detail    String
  qty       Int
  requestId String
  request   RequestEquipment? @relation(fields: [requestId], references: [id])
}

model AssetType {
  id    Int     @id @default(autoincrement())
  name  String  @unique
  Asset Asset[]
}

model Asset {
  id          Int         @id @default(autoincrement())
  name        String      @unique
  assetTypeId Int
  assetType   AssetType?  @relation(fields: [assetTypeId], references: [id])
  Equipment   Equipment[]
}
